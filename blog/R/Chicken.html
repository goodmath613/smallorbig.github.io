<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<title>Chicken.html</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<link rel="stylesheet" type="text/css" media="all" href="gh.css"  />
</head>

<body>

[WARNING] Could not parse YAML metadata at line 46 column 1: :4:0: Lexical error near "Windows \54872\44221\50640\49436 R \48260\51260\51008 `3.6.0`, RStudio \48260\51260\51008 `1.1.463` \51004\47196 \51096 \51089\46041\54632\51012 \54869\51064\54664\49845\45768\45796. \50500\47000 \47553\53356\47196 `data.xlsx`\47484 \45796\50868\47196\46300 \54620 \46244\50640 \45796\51020 \45800\44228\47484 \46384\46972\54633\45768\45796."
<h1 id="r-실습-및-소개">R 실습 및 소개</h1>
<p>Updated : 2019년 5월 26일</p>
<hr />
<h2 id="rstudio-시작하기">RStudio 시작하기</h2>
<h3 id="화면-구성">화면 구성</h3>
<p><img src="Chicken/images/scr.png" /></p>
<ul>
<li>Script 창에 코드입력</li>
<li>Script 창에서 코드 실행 (Ctrl + Enter)</li>
<li>Console 창에서 명령어 실행</li>
<li>Environment 창에서 변수 확인</li>
<li>Etc. 창에서 파일 및 폴더, Ploting 이미지 등 확인</li>
</ul>
<h2 id="대뜸-따라하기">대뜸 따라하기</h2>
<p><strong>문제 : 우리동네 치킨집은 몇 개일까?</strong></p>
<h3 id="문제-해석">문제 해석</h3>
<ul>
<li>우리동네 : 금정구의 동단위 정보로 제한</li>
<li><code>치킨집</code> : 등록된 “업태구분명”에 “통닭”이 들어가는 모든 가게</li>
<li><strong>목표</strong> : 금정구의 동별 <code>치킨집</code> 갯수 계산</li>
</ul>
<h3 id="문제-해결-순서">문제 해결 순서</h3>
<ol type="1">
<li>데이터 얻기
<ul>
<li>어디서 어떤 자료를 모아야 할까?</li>
</ul></li>
<li>자료 전처리 및 통계량 계산
<ul>
<li>동별 업태구분에 따른 가게 정보만 가져올 수 있을까?</li>
<li>데이터의 형태를 어떻게 정리할까?</li>
<li>자료 정리를 위한 방법은?</li>
<li>갯수를 세는 기준과 방법은?</li>
</ul></li>
<li>시각화
<ul>
<li>어떻게 표현하는게 가장 통계량 결과를 잘 볼 수 있을까?</li>
</ul></li>
</ol>
<hr />
<h4 id="데이터-얻기">1. 데이터 얻기</h4>
<ul>
<li>지방행정 인허가 데이터개방 사이트 LOCALDATA
<ul>
<li>URL : <a href="http://www.localdata.kr" class="uri">http://www.localdata.kr</a></li>
</ul></li>
</ul>
<p><img src="Chicken/images/lec1.png" title="Homepage" /></p>
<p><img src="Chicken/images/lec2.png" title="Download Page" /></p>
<ul>
<li>부산광역시 데이터 다운로드 (압축된 191개 파일, 약 100mb 용량)
<ul>
<li><code>6260000_부산광역시_07_24_04_P_일반음식점.xlsx</code> 하나의 파일만 사용 (쉽게 사용하기 위해서 <code>data.xlsx</code>로 이름을 변경해서 사용하겠습니다.)</li>
</ul></li>
</ul>
<hr />
<h4 id="데이터-전처리-및-통계량-계산">2. 데이터 전처리 및 통계량 계산</h4>
<h5 id="작업-디렉토리-변경">* 작업 디렉토리 변경</h5>
<p>RStudio의 작업 디렉토리(working directory)를 <code>0607_R</code> 로 설정합니다. 기본 작업 디렉토리는 <code>내 문서</code>로 되어 있습니다. 다음 명령어를 입력합니다.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">setwd</span>(<span class="st">&quot;0607_R&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">getwd</span>()</a></code></pre></div>
<h5 id="파일을-불러들여-stores-변수에-저장한다.">* 파일을 불러들여 <code>stores</code> 변수에 저장한다.</h5>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">library</span>(readxl)</a>
<a class="sourceLine" id="cb2-3" title="3"></a>
<a class="sourceLine" id="cb2-4" title="4">stores &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data.xlsx&quot;</span>)</a>
<a class="sourceLine" id="cb2-5" title="5"></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="kw">head</span>(stores)</a></code></pre></div>
<h5 id="stores-변수의-여러가지-정보를-확인한다.">* <code>stores</code> 변수의 여러가지 정보를 확인한다.</h5>
<p><code>stores</code> 는 일종의 행렬로써 행과 열의 정보를 갖는다. 각 행은 행 번호가 있고, 각 열은 열 이름(colname)이 있다. 우리는 각 열 정보를 확인하고, 필요한 열를 모은다.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="co"># stores 각 열의 이름</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">colnames</span>(stores)</a>
<a class="sourceLine" id="cb3-3" title="3"></a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># &quot;소재지전체주소&quot; 열의 첫 6행</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">head</span>(stores<span class="op">$</span>소재지전체주소)</a>
<a class="sourceLine" id="cb3-6" title="6"></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co"># &quot;업태구분명&quot; 열의 첫 6행</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="kw">head</span>(stores<span class="op">$</span>업태구분명)</a>
<a class="sourceLine" id="cb3-9" title="9"></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co"># &quot;업태구분명&quot; 열의 서로 다른 모든 값들의 모임</span></a>
<a class="sourceLine" id="cb3-11" title="11"><span class="kw">unique</span>(stores<span class="op">$</span>업태구분명)</a>
<a class="sourceLine" id="cb3-12" title="12"></a>
<a class="sourceLine" id="cb3-13" title="13"><span class="co"># &quot;사업장명&quot; 열의 첫 6행</span></a>
<a class="sourceLine" id="cb3-14" title="14"><span class="kw">head</span>(stores<span class="op">$</span>사업장명)</a></code></pre></div>
<h5 id="소재지전체주소와-업태구분명만을-갖는-store_trim-변수를-새로-만들어-우리가-원하는-형태로-가공한다.">* “소재지전체주소”와 “업태구분명”만을 갖는 <code>store_trim</code> 변수를 새로 만들어 우리가 원하는 형태로 가공한다.</h5>
<p>먼저 편리함을 위해서 열 이름을 영어로 바꾼다. 그리고 다음 필터링을 적용하자.</p>
<ul>
<li>소재지전체주소 : “금정구”가 포함되는 행을 모으자.</li>
<li>업태구분명 : “통닭”이 포함되는 행을 모으자.</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">stores_trim &lt;-<span class="st"> </span>stores[, <span class="kw">c</span>(<span class="st">&quot;소재지전체주소&quot;</span>, <span class="st">&quot;업태구분명&quot;</span>)]</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw">colnames</span>(stores_trim) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;address&quot;</span>, <span class="st">&quot;business&quot;</span>)</a>
<a class="sourceLine" id="cb4-3" title="3"></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co"># 금정구에 속하는 통닭 가게 데이터를 ck 변수로 할당</span></a>
<a class="sourceLine" id="cb4-5" title="5">ck &lt;-<span class="st"> </span>stores_trim <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="st">        </span><span class="kw">filter</span>(</a>
<a class="sourceLine" id="cb4-7" title="7">          <span class="kw">str_detect</span>(address, <span class="st">&quot;금정구&quot;</span>) <span class="op">&amp;</span></a>
<a class="sourceLine" id="cb4-8" title="8"><span class="st">          </span><span class="kw">str_detect</span>(business, <span class="st">&quot;통닭&quot;</span>)</a>
<a class="sourceLine" id="cb4-9" title="9">        )</a>
<a class="sourceLine" id="cb4-10" title="10"><span class="kw">head</span>(ck)  <span class="co"># 잘 가공되었는지 확인</span></a></code></pre></div>
<!--
- `str` 가공 참고 : <https://wsyang.com/2014/07/stringr-package/>
-->
<h5 id="address의-상세-주소를-동이름만-남기도록-바꾸자.">* “address”의 상세 주소를 동이름만 남기도록 바꾸자.</h5>
<p>예를 들면 “부산광역시 금정구 장전동 419-21번지”라는 주소에서 “장전동”만을 남기려고 한다면 어떤 방법을 사용하면 될까요? 여기서는 “[공백]장전동[공백]”를 모아서, 양쪽 [공백]을 제거하는 방법을 사용했습니다. 아래와 같이 텍스트를 가공하는 방식을 정규표현식(Regular Expression)이라고 합니다.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">ck<span class="op">$</span>address &lt;-<span class="st"> </span><span class="kw">str_extract</span>(ck<span class="op">$</span>address, <span class="st">&quot;</span><span class="ch">\\</span><span class="st">s</span><span class="ch">\\</span><span class="st">S+동</span><span class="ch">\\</span><span class="st">s&quot;</span>)</a>
<a class="sourceLine" id="cb5-2" title="2">ck<span class="op">$</span>address &lt;-<span class="st"> </span><span class="kw">str_trim</span>(ck<span class="op">$</span>address, <span class="dt">side=</span><span class="st">&quot;both&quot;</span>)</a></code></pre></div>
<ul>
<li>간단한 정규표현식</li>
</ul>
<p>정규표현식에 통달하기는 아주 어렵지만, 간단한 정규표현식으로도 많은 것을 할 수 있다.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">표현</th>
<th style="text-align: left;">역할</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">\ 숫자</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: center;">\</td>
<td style="text-align: left;">숫자 아닌 것</td>
</tr>
<tr class="odd">
<td style="text-align: center;">\</td>
<td style="text-align: left;">공백</td>
</tr>
<tr class="even">
<td style="text-align: center;">\</td>
<td style="text-align: left;">공백 아닌 것</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[0-9]</td>
<td style="text-align: left;">모든 숫자</td>
</tr>
<tr class="even">
<td style="text-align: center;">[A-Z]</td>
<td style="text-align: left;">영어 대문자</td>
</tr>
<tr class="odd">
<td style="text-align: center;">[a-z]</td>
<td style="text-align: left;">영어 소문자</td>
</tr>
<tr class="even">
<td style="text-align: center;">[A-z]</td>
<td style="text-align: left;">모든 영문자</td>
</tr>
<tr class="odd">
<td style="text-align: center;">i+</td>
<td style="text-align: left;">i가 최소 1회 이상 나오는 경우</td>
</tr>
<tr class="even">
<td style="text-align: center;">i{n1,n2}</td>
<td style="text-align: left;">i가 n1에서 n2회 나오는 경우경우</td>
</tr>
</tbody>
</table>
<p><strong>중요</strong> 이제 “address”에 속한 <em>동 이름</em> 이 몇 번 중복하느냐가 그 동에 속한 <code>치킨집</code> 갯수 입니다!</p>
<h5 id="ck의-address열-하나에-대해서-중복-값을-센다.">* <code>ck</code>의 “address”열 하나에 대해서 중복 값을 센다.</h5>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">table</span>(ck<span class="op">$</span>address)</a></code></pre></div>
<h4 id="시각화">3. 시각화</h4>
<p><code>ggplot2</code> 패키지를 사용해서 여러가지 방법으로 시각화를 해 봅니다. <code>ggplot()</code> 함수를 사용하는 시각화는 기본적으로 다음과 같은 구조를 따릅니다.</p>
<pre><code>ggplot(data=OBJECT,
  aes(x=column_1, y=column_2)) +
  geom_xx() +
  [추가옵션]</code></pre>
<h5 id="히스토그램">* 히스토그램</h5>
<p><code>data.frame()</code> 함수는 주어진 대상을 데이터프레임 자료형으로 바꿔주는 함수입니다. 데이터프레임은 데이터 분석에 용이한데, 다음과 같은 특징들을 갖습니다.</p>
<ul>
<li>행과 열로 구성되어 있고, 2차원 구조이다.</li>
<li>여러 개의 데이터 유형을 가질 수 있다.</li>
<li>하나의 열은 하나의 데이터 유형만 갖는다.</li>
<li>다른 열은 다른 데이터 유형을 가질 수 있다.</li>
</ul>
<p>우리는 <code>치킨집</code> 갯수에 관한 데이터프레임을 만들어 히스토그램으로 표현해봅니다.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">table</span>(ck<span class="op">$</span>address))</a>
<a class="sourceLine" id="cb8-2" title="2"></a>
<a class="sourceLine" id="cb8-3" title="3"><span class="kw">head</span>(df)    <span class="co"># 내용 확인</span></a>
<a class="sourceLine" id="cb8-4" title="4"></a>
<a class="sourceLine" id="cb8-5" title="5"><span class="kw">colnames</span>(df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;address&quot;</span>,<span class="st">&quot;chicken&quot;</span>)</a>
<a class="sourceLine" id="cb8-6" title="6"></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="kw">ggplot</span>(df,</a>
<a class="sourceLine" id="cb8-8" title="8">  <span class="kw">aes</span>(<span class="dt">x=</span>address, <span class="dt">y=</span>chicken)) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="st">  </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="st">  </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<hr />
<h4 id="지도-칠하기-중급">지도 칠하기 (중급)</h4>
<h5 id="지도-파일을-다운받습니다.">* 지도 파일을 다운받습니다.</h5>
<p>본 강의에서는 <code>shp</code> 확장자의 지도 데이터를 사용했습니다. 2019년 2월 업데이트 된 읍면동 지도데이터를 다운로드 합니다.</p>
<ul>
<li>다운로드 링크 : <code>2019년 2월 읍면동.zip</code> 압축파일 (약 37mb)</li>
</ul>
<p><a href="https://drive.google.com/open?id=1PE4VE0qqAeVT07XHQGFhTVfP938nyC8j" class="uri">https://drive.google.com/open?id=1PE4VE0qqAeVT07XHQGFhTVfP938nyC8j</a></p>
<!--
   - 지도자료 참고 : <http://www.gisdeveloper.co.kr/?p=2332>
-->
<h5 id="지도-데이터를-이미지화-해봅니다.">* 지도 데이터를 이미지화 해봅니다.</h5>
<p><code>0607_R</code> 폴더 아래 <code>map</code> 폴더를 만들어 다운로드 한 압축파일을 압축해제합니다. 불러올 지도데이터 파일명은 <code>TL_SCCO_EMD.shp</code> 입니다.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">install.packages</span>(<span class="st">&quot;rgdal&quot;</span>)</a>
<a class="sourceLine" id="cb9-2" title="2"><span class="kw">library</span>(rgdal)</a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4">file_name &lt;-<span class="st"> &quot;map/TL_SCCO_EMD.shp&quot;</span></a>
<a class="sourceLine" id="cb9-5" title="5">korea &lt;-<span class="st"> </span><span class="kw">readOGR</span>(file_name, <span class="dt">stringsAsFactors=</span>F)</a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="kw">head</span>(korea)</a></code></pre></div>
<p>형태가 복잡합니다. 좀 더 이해하기 쉬운 형태로 다루기 위해서 아래 코드를 입력합니다.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="kw">head</span>(korea<span class="op">@</span>data)</a>
<a class="sourceLine" id="cb10-2" title="2"></a>
<a class="sourceLine" id="cb10-3" title="3"><span class="kw">install.packages</span>(<span class="st">&quot;raster&quot;</span>)</a>
<a class="sourceLine" id="cb10-4" title="4"><span class="kw">library</span>(raster)</a>
<a class="sourceLine" id="cb10-5" title="5"></a>
<a class="sourceLine" id="cb10-6" title="6"><span class="kw">head</span>(korea)</a></code></pre></div>
<p>한층 보기 쉬워졌습니다. 하지만 실제로 자료 구조가 바뀌진 않았다는 사실을 상기해주세요.</p>
<p>열 이름을 확인해보면 EMD_CD(읍면동 코드), EMD_ENG_NM(읍면동 영어 이름), EMD_KOR_NM(읍면동 한글 이름)으로 이루어져 있습니다. 이중에서 읍면동 코드 중 <code>26</code>으로 시작하는 번호가 부산이고, <code>2641</code>로 시작하는 부분은 금정구 입니다. 우리는 <code>2641</code>로 시작하는 코드를 갖는 행을 <code>gj</code>라고 할당하여 이미지를 그려보겠습니다.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">gj &lt;-<span class="st"> </span>korea[<span class="kw">grepl</span>(<span class="st">&quot;^2641&quot;</span>, korea<span class="op">$</span>EMD_CD), ]</a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">plot</span>(gj)    <span class="co"># 쉽게 그릴 수 있지만 다양한 옵션을 주기 어렵습니다.</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw">ggplot</span>(gj,</a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb11-7" title="7"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">group =</span> group),</a>
<a class="sourceLine" id="cb11-8" title="8">    color =<span class="st"> &quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb11-9" title="9">    fill =<span class="st"> &quot;white&quot;</span><span class="er">)</span></a></code></pre></div>
<p>경도(longitude), 위도(latitude)의 숫자 지도를 표현하는 방식에 따라 차이가 있습니다. 다음 코드를 실행해서 익숙한 경위도 단위로 바꿔봅니다.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="co"># install.packages(&quot;sp&quot;)</span></a>
<a class="sourceLine" id="cb12-2" title="2"><span class="kw">library</span>(sp)</a>
<a class="sourceLine" id="cb12-3" title="3"></a>
<a class="sourceLine" id="cb12-4" title="4">gj &lt;-<span class="st"> </span><span class="kw">spTransform</span>(gj,</a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="kw">CRS</span>(<span class="st">&quot;+proj=longlat +ellps=WGS84 +datum=WGS84&quot;</span>))</a>
<a class="sourceLine" id="cb12-6" title="6"></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="kw">ggplot</span>(gj,</a>
<a class="sourceLine" id="cb12-8" title="8">  <span class="kw">aes</span>(<span class="dt">x =</span> long, <span class="dt">y =</span> lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="st">  </span><span class="kw">geom_polygon</span>(<span class="dt">group =</span> group),</a>
<a class="sourceLine" id="cb12-10" title="10">    color =<span class="st"> &quot;black&quot;</span>,</a>
<a class="sourceLine" id="cb12-11" title="11">    fill =<span class="st"> &quot;white&quot;</span><span class="er">)</span></a></code></pre></div>
<!--
혹시 궁금하신 분들은 R에서 경위도 단위 변환에 대해서 작성한 다음 블로그 글을 참고해도 좋겠습니다.

- URL : <https://lovetoken.github.io/r/data_visualization/2018/04/15/sp_proj4string_spTransform.html>
-->
<h5 id="금정구-지도-데이터를-data.frame-자료형으로-변환하여-원하는-형태로-병합한다.">* 금정구 지도 데이터를 data.frame 자료형으로 변환하여, 원하는 형태로 병합한다.</h5>
<p><code>gj</code> 변수는 현재 <code>shp</code> 파일로부터 읽어들인 자료로 <code>S4</code> 자료형인데 이를 다루기위해 <code>df</code>과 같은 자료형인 데이터프레임으로 변환한다.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">gj_data &lt;-<span class="st"> </span><span class="kw">fortify</span>(gj)</a>
<a class="sourceLine" id="cb13-2" title="2"></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">head</span>(gj_data)</a></code></pre></div>
<p>우리가 원하는 데이터 형태는 다음과 같습니다.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">경도(long)</th>
<th style="text-align: center;">위도(lat)</th>
<th style="text-align: center;">동 이름(address)</th>
<th style="text-align: center;">치킨집 갯수(chicken)</th>
<th style="text-align: center;">…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
</tr>
<tr class="even">
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
<td style="text-align: center;">…</td>
</tr>
</tbody>
</table>
<p>열의 순서는 상관없지만 위와 같은 정보로 정리하기 위해서 다음 변수들을 고려합니다.</p>
<ul>
<li><p><code>dj</code>는 지도자료로 모든 동 이름 정보를 모두 갖고 있습니다. <code>dong</code> 변수명으로 모든 동 이름을 저장합니다.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">dong &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">unique</span>(dj<span class="op">$</span>EMD_KOR_NM))</a>
<a class="sourceLine" id="cb14-2" title="2"></a>
<a class="sourceLine" id="cb14-3" title="3"><span class="kw">colnames</span>(dong) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;address&quot;</span>)</a>
<a class="sourceLine" id="cb14-4" title="4"></a>
<a class="sourceLine" id="cb14-5" title="5"><span class="kw">head</span>(dong)</a></code></pre></div></li>
<li><p><code>df</code>는 각 동별로 치킨집 갯수 정보를 모두 갖고 있습니다. <code>dong</code>의 각 동이름에 치킨집 갯수를 병합하여 <code>dong_df</code> 변수에 할당하겠습니다. 다만, <code>all=TRUE</code> 옵션으로 <code>df</code> 에 없는 동 이름이 있을 경우, 해당 행의 chicken 열에 결측치 <code>NA</code>를 저장합니다. 이후에 이 부분을 모두 0으로 바꿔줍니다.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">dong_df &lt;-<span class="st"> </span><span class="kw">merge</span>(dong, df, <span class="dt">by=</span><span class="st">&quot;address&quot;</span>, <span class="dt">all=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb15-2" title="2"></a>
<a class="sourceLine" id="cb15-3" title="3">dong_df<span class="op">$</span>chicken[<span class="kw">is.na</span>(dong_df<span class="op">$</span>chicken)] &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb15-4" title="4"></a>
<a class="sourceLine" id="cb15-5" title="5"><span class="kw">head</span>(dong_df)</a></code></pre></div></li>
<li><p><code>fortify()</code> 함수로 지도데이터 <code>gj</code> 에 저장된 경위도 데이터 및 기타 정보를 데이터프레임 형태로 바꿔 <code>gj_data</code> 변수에 할당하겠습니다.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">gj_data &lt;-<span class="st"> </span><span class="kw">fortify</span>(gj)</a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="kw">head</span>(gj_data)</a></code></pre></div></li>
<li><p><code>gj_data</code> 는 동 이름을 갖고 있지 않습니다. 기준이 될 행 번호 열을 따로 만들어 각 행번호에 해당하는 동 이름을 지도데이터 <code>gj</code>에서 가져와 <code>gj_data</code>에 추가하여 <code>gj_data_id</code>에 할당하도록 하겠습니다.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1">gj<span class="op">@</span>data<span class="op">$</span>id &lt;-<span class="st"> </span><span class="kw">rownames</span>(gj<span class="op">@</span>data)</a>
<a class="sourceLine" id="cb17-2" title="2"></a>
<a class="sourceLine" id="cb17-3" title="3">gj_data_id &lt;-<span class="st"> </span><span class="kw">merge</span>(gj_data,</a>
<a class="sourceLine" id="cb17-4" title="4">                gj<span class="op">@</span>data[, <span class="kw">c</span>(<span class="st">&quot;EMD_KOR_NM&quot;</span>, <span class="st">&quot;id&quot;</span>)],</a>
<a class="sourceLine" id="cb17-5" title="5">                <span class="dt">by=</span><span class="st">&quot;id&quot;</span>, <span class="dt">all=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb17-6" title="6"></a>
<a class="sourceLine" id="cb17-7" title="7">gj_data_id &lt;-<span class="st"> </span><span class="kw">rename</span>(gj_data_id,</a>
<a class="sourceLine" id="cb17-8" title="8">                <span class="st">&quot;address&quot;</span>=<span class="st">&quot;EMD_KOR_NM&quot;</span>)</a>
<a class="sourceLine" id="cb17-9" title="9"></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="kw">head</span>(gj_data_id)</a></code></pre></div></li>
<li><p>이제 마지막으로 <code>gj_data_id</code>는 치킨집 갯수 이외의 우리가 원하는 모든 정보를 갖고 있습니다. <code>dong_df</code> 로부터 각 동에 해당하는 치킨집 갯수를 추가하여 <code>gj_ck</code> 변수에 할당하도록 하겠습니다.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1">gj_ck &lt;-<span class="st"> </span><span class="kw">merge</span>(gj_data_id, dong_df,</a>
<a class="sourceLine" id="cb18-2" title="2">   <span class="dt">by=</span><span class="st">&quot;address&quot;</span>, <span class="dt">all=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb18-3" title="3"></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="kw">head</span>(gj_ck)</a></code></pre></div></li>
</ul>
<ol start="4" type="1">
<li>지도 이미지를 <code>gj_ck</code> 자료로 색칠하기</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"><span class="kw">ggplot</span>(gj_ck,</a>
<a class="sourceLine" id="cb19-2" title="2">     <span class="kw">aes</span>(<span class="dt">x =</span> long,</a>
<a class="sourceLine" id="cb19-3" title="3">         <span class="dt">y =</span> lat)) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-4" title="4"><span class="st">     </span><span class="kw">geom_polygon</span>(<span class="kw">aes</span>(<span class="dt">group =</span> group, <span class="dt">fill =</span> chicken),</a>
<a class="sourceLine" id="cb19-5" title="5">         <span class="dt">color =</span> <span class="st">&#39;black&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb19-6" title="6"><span class="st">     </span><span class="kw">coord_fixed</span>() <span class="op">+</span><span class="st">                  </span><span class="co"># 가로 세로 비율 고정</span></a>
<a class="sourceLine" id="cb19-7" title="7"><span class="st">     </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&#39;white&#39;</span>, <span class="dt">high =</span> <span class="st">&#39;blue&#39;</span>)</a></code></pre></div>

</body>
</html>
